@model RSM.BOL.Models.Owner
@{
    var ownerId = ViewBag.OwnerId;
}
@using (Html.BeginForm("GetProperty", "Owner", FormMethod.Post,
    new { @class = "form-horizontal form-label-left input_mask", @id = "myForm", @enctype = "multipart/form-data" }))
{
        @*@Html.HiddenFor(model => model.OwnerID, new {Id="ownerID"})*@
    <div class="form-group">
        <div class="col-md-9 col-sm-9 col-xs-12">
            <h2>PropertyCount:@ViewBag.propertyCount</h2>
        </div>
    </div>
}
<!-- Button to open the popup -->
<button id="showPopupButton" type="button" data-owner-id=@ownerId>Show Properties</button> <!-- Assuming OwnerID is 101 for demonstration -->
<!-- The Popup Modal -->
<div id="myModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Properties for Owner</h2>
        <div id="propertyList"></div> <!-- This will hold the property data -->
    </div>
</div>

<!-- Add some basic styling for the modal -->
<style>
    .modal {
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
    }

    .close-button {
        float: right;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
    }
</style>

<!-- JavaScript to handle the popup display and data fetching -->
@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>*@
<script>
    var modal = document.getElementById("myModal");
    var btn = document.getElementById("showPopupButton");
    var closeBtn = document.querySelector(".close-button");

    // Show the modal and fetch data when the button is clicked
    btn.onclick = function () {
        var ownerId = $(this).data("owner-id");

        $.ajax({
            url: '@Url.Action("GetPropertiesByOwner", "Owner")', // Replace YourControllerName with the actual controller name
            type: 'GET',
            data: { id: ownerId  },
            success: function (data) {
                var propertyList = $('#propertyList');
                propertyList.empty(); // Clear any existing content

                if (data.length > 0) {
                    data.forEach(function (property) {
                        propertyList.append('<p>PropertyType: ' + property.PropertyType + ', PlotNo: ' + property.PlotNo + '</p>');
                    });
                } else {
                    propertyList.append('<p>No properties found for this owner.</p>');
                }

                modal.style.display = "block"; // Show the modal after data is loaded
            },
            error: function () {
                alert('Failed to load property data.');
            }
        });
    };

    // Close the modal
    closeBtn.onclick = function () {
        modal.style.display = "none";
    };

    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };
</script>
